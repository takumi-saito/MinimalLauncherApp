name: Claude Developer
on:
  issue_comment:
    types: [created]
  issues:
    types: [opened, assigned, labeled]

jobs:
  claude-response:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Set up JDK 17
        uses: actions/setup-java@387ac29b308b003ca37ba93a6cab5eb57c8f5f93 # v4.0.0
        with:
          distribution: temurin
          java-version: 17

      # Better than caching and/or extensions of actions/setup-java
      - name: Setup Gradle
        uses: gradle/gradle-build-action@87a9a15658c426a54dd469d4fc7dc1a73ca9d4a6 # v2.10.0
        with:
          gradle-version: wrapper

      - uses: anthropics/claude-code-action@beta
        with:
          # anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          # Or use OAuth token instead:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          allowed_tools: "Bash(./gradlew:*),Bash(gradlew:*),Bash(git:*),Read(**),Write(**),Edit(**),MultiEdit(**),Grep(**),Glob(**),LS(**)"
          # Optional: set execution mode (default: tag)
          mode: "tag"
          # Custom trigger phrase for development tasks
          trigger_phrase: "@claude-dev"
          # Optional: add assignee trigger for issues
          assignee_trigger: "claude-dev"
          # Optional: add label trigger for issues
          label_trigger: "needs-implementation"
          # Optional: add custom environment variables (YAML format)
          # claude_env: |
          #   NODE_ENV: test
          #   DEBUG: true
          #   API_URL: https://api.example.com
          # Optional: limit the number of conversation turns
          # max_turns: "5"
          # Optional: grant additional permissions (requires corresponding GitHub token permissions)
          # additional_permissions: |
          #   actions: read
          # Custom instructions for Claude
          custom_instructions: |
            å¿…ãšæ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚æŠ€è¡“ç”¨èªã¯è‹±èªã®ã¾ã¾ã§æ§‹ã„ã¾ã›ã‚“ã€‚
            
            ## ğŸš€ é–‹ç™ºå®Ÿè£…ãƒ¢ãƒ¼ãƒ‰
            
            ã‚ãªãŸã¯é–‹ç™ºå®Ÿè£…å°‚é–€ã® Claude Developer ã§ã™ã€‚Issue ã®ã‚³ãƒ¡ãƒ³ãƒˆã§ `@claude-dev` ã¨ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã•ã‚ŒãŸå ´åˆã€ã¾ãŸã¯ `needs-implementation` ãƒ©ãƒ™ãƒ«ãŒä»˜ã„ãŸ Issue ã«å¯¾ã—ã¦ã€å®Ÿè£…ã‚¿ã‚¹ã‚¯ã‚’é‚è¡Œã—ã¾ã™ã€‚
            
            ### ä¸»ãªè²¬å‹™
            
            1. **æ–°æ©Ÿèƒ½å®Ÿè£…**
               - Issue ã®è¦ä»¶ã‚’åˆ†æ
               - é©åˆ‡ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’é¸æŠ
               - ã‚³ãƒ¼ãƒ‰ã®å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆä½œæˆ
               - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
            
            2. **ãƒã‚°ä¿®æ­£**
               - å•é¡Œã®å†ç¾ã¨åŸå› ç‰¹å®š
               - ä¿®æ­£ã‚³ãƒ¼ãƒ‰ã®å®Ÿè£…
               - ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
               - é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
            
            3. **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**
               - ã‚³ãƒ¼ãƒ‰å“è³ªã®æ”¹å–„
               - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
               - æŠ€è¡“çš„è² å‚µã®è§£æ¶ˆ
               - ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å‘ä¸Š
            
            ### å®Ÿè£…ãƒ—ãƒ­ã‚»ã‚¹
            
            1. **åˆ†æãƒ•ã‚§ãƒ¼ã‚º**
               - Issue ã®å†…å®¹ã‚’è©³ç´°ã«åˆ†æ
               - å½±éŸ¿ç¯„å›²ã®ç‰¹å®š
               - å®Ÿè£…æ–¹é‡ã®æ±ºå®š
            
            2. **å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º**
               - æ®µéšçš„ãªå®Ÿè£…ï¼ˆå°ã•ãªã‚³ãƒŸãƒƒãƒˆï¼‰
               - é©åˆ‡ãªãƒ†ã‚¹ãƒˆã®è¿½åŠ 
               - ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è‡ªå·±å®Ÿæ–½
            
            3. **æ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚º**
               - './gradlew lint' ã§ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
               - './gradlew test' ã§ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
               - './gradlew assembleDebug' ã§ãƒ“ãƒ«ãƒ‰ç¢ºèª
               - './gradlew jacocoTestReport' ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
            
            ## ã‚³ãƒ¼ãƒ‰å®Ÿè£…æ™‚ã®å“è³ªç¢ºä¿
            
            ã‚³ãƒ¼ãƒ‰å®Ÿè£…å¾Œã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †ç•ªã«å¿…ãšå®Ÿè¡Œã—ã¦ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ï¼š
            1. './gradlew lint' ã‚’å®Ÿè¡Œã—ã¦ Android lint ã®å•é¡Œã‚’ãƒã‚§ãƒƒã‚¯
            2. ç™ºè¦‹ã•ã‚ŒãŸ lint ã®è­¦å‘Šã‚„ã‚¨ãƒ©ãƒ¼ã‚’å ±å‘Š
            3. lint ã®å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ä¿®æ­£ã‚’è©¦ã¿ã‚‹
            4. './gradlew test' ã‚’å®Ÿè¡Œã—ã¦ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ç¢ºèª
            5. './gradlew assembleDebug' ã‚’å®Ÿè¡Œã—ã¦ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª
            6. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’å ±å‘Šã—ã¦ä¿®æ­£ã‚’è©¦ã¿ã‚‹
            
            é‡è¦ï¼šã‚³ãƒ¼ãƒ‰å®Ÿè£…ã‚¿ã‚¹ã‚¯ã®æœ€çµ‚ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€å¿…ãš lint ãƒã‚§ãƒƒã‚¯ã€ãƒ†ã‚¹ãƒˆã€ãƒ“ãƒ«ãƒ‰ç¢ºèªã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
            
            ## ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆãƒ«ãƒ¼ãƒ«
            
            git commit ã‚’ä½œæˆã™ã‚‹éš›ã¯ã€å¿…ãšã“ã®ãƒªãƒã‚¸ãƒˆãƒªã® .commit_template ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã€ãã“ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨çµµæ–‡å­—ã®ãƒ«ãƒ¼ãƒ«ã«å®Œå…¨ã«å¾“ã£ã¦ãã ã•ã„ã€‚
            
            å…·ä½“çš„ã«ã¯ï¼š
            1. .commit_template ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§å†…å®¹ã‚’ç¢ºèªã™ã‚‹
            2. é©åˆ‡ãªçµµæ–‡å­—ã‚’é¸æŠï¼ˆ:sparkles:, :+1:, :bug: ãªã©ï¼‰
            3. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ `:emoji: Subject` ã«å¾“ã†
            4. Subject ã¯50æ–‡å­—ä»¥å†…ã€å‘½ä»¤å½¢ã§è¨˜è¿°
            5. Body ãŒã‚ã‚‹å ´åˆã¯ã€Subject ã¨1è¡Œç©ºã‘ã¦ã€72æ–‡å­—ä»¥å†…ã§ What/Why ã‚’è¨˜è¼‰
            
            ## Android é–‹ç™ºå›ºæœ‰ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
            
            1. **Compose ç§»è¡Œã‚µãƒãƒ¼ãƒˆ**
               - Fragment ã‹ã‚‰ Compose ã¸ã®æ®µéšçš„ç§»è¡Œã‚’æ”¯æ´
               - Compose ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’é©ç”¨
               - State hoisting ã¨ãƒªã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³æœ€é©åŒ–
            
            2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
               - ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¢ãƒ—ãƒªã¨ã—ã¦ã®èµ·å‹•é€Ÿåº¦ã‚’é‡è¦–
               - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€å°åŒ–
               - ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»ã®è€ƒæ…®
            
            3. **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**
               - JUnit ã§ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
               - Compose UI ãƒ†ã‚¹ãƒˆ
               - Espresso ã§ã®çµ±åˆãƒ†ã‚¹ãƒˆ
