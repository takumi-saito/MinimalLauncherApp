name: Claude Assistant
on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned, labeled]
  pull_request_review:
    types: [submitted]
  pull_request:
    types: [opened, edited, synchronize, ready_for_review]

jobs:
  claude-response:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Set up JDK 17
        uses: actions/setup-java@387ac29b308b003ca37ba93a6cab5eb57c8f5f93 # v4.0.0
        with:
          distribution: temurin
          java-version: 17

      # Better than caching and/or extensions of actions/setup-java
      - name: Setup Gradle
        uses: gradle/gradle-build-action@87a9a15658c426a54dd469d4fc7dc1a73ca9d4a6 # v2.10.0
        with:
          gradle-version: wrapper

      - uses: anthropics/claude-code-action@beta
        with:
          # anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          # Or use OAuth token instead:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          allowed_tools: "Bash(./gradlew:*),Bash(gradlew:*),Read(**),Grep(**),Edit(**)"
          # Optional: set execution mode (default: tag)
          # mode: "tag"
          # Optional: add custom trigger phrase (default: @claude)
          # trigger_phrase: "/claude"
          # Optional: add assignee trigger for issues
          # assignee_trigger: "claude"
          # Optional: add label trigger for issues
          # label_trigger: "claude"
          # Optional: add custom environment variables (YAML format)
          # claude_env: |
          #   NODE_ENV: test
          #   DEBUG: true
          #   API_URL: https://api.example.com
          # Optional: limit the number of conversation turns
          # max_turns: "5"
          # Optional: grant additional permissions (requires corresponding GitHub token permissions)
          # additional_permissions: |
          #   actions: read
          # Custom instructions for Claude
          custom_instructions: |
            å¿…ãšæ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚æŠ€è¡“ç”¨èªã¯è‹±èªã®ã¾ã¾ã§æ§‹ã„ã¾ã›ã‚“ã€‚
            
            ## Pull Request ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®å‹•ä½œ
            
            Pull Request ã«å¯¾ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸå ´åˆã€ã¾ãŸã¯æ–°è¦ PR ãŒä½œæˆã•ã‚ŒãŸå ´åˆï¼š
            
            1. **PR ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè§£æ**
               - .github/pull_request_template.md ã‚’å‚ç…§
               - PR ã®æœ¬æ–‡ã‹ã‚‰ä»¥ä¸‹ã®æƒ…å ±ã‚’æŠ½å‡ºï¼š
                 - å¤‰æ›´ç¨®åˆ¥ï¼ˆæ–°æ©Ÿèƒ½ã€ãƒã‚°ä¿®æ­£ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãªã©ï¼‰
                 - å¤‰æ›´è©³ç´°ã¨ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«
                 - ãƒ†ã‚¹ãƒˆå®Ÿæ–½çŠ¶æ³
                 - AI Agent ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆYAML å½¢å¼ï¼‰
            
            2. **è‡ªå‹•ãƒã‚§ãƒƒã‚¯é …ç›®**
               - [ ] PR ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¿…é ˆé …ç›®ãŒè¨˜å…¥ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
               - [ ] ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
               - [ ] ç ´å£Šçš„å¤‰æ›´ã®æœ‰ç„¡ã‚’ç¢ºèª
               - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿ã‚’è©•ä¾¡
               - [ ] Android å›ºæœ‰ã®è€ƒæ…®äº‹é …ã‚’ãƒã‚§ãƒƒã‚¯ï¼š
                 - æœ€å° SDK 26 ã¨ã®äº’æ›æ€§
                 - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ SDK 33 ã¸ã®æº–æ‹ 
                 - Material Design ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³æº–æ‹ 
            
            3. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼åŸºæº–**
               - Kotlin/Java ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„éµå®ˆ
               - Jetpack Compose ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
               - Hilt DI ã®é©åˆ‡ãªä½¿ç”¨
               - ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã®é˜²æ­¢
               - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãƒ†ã‚£
               - ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ï¼ˆãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¢ãƒ—ãƒªã¨ã—ã¦é‡è¦ï¼‰
            
            4. **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**
               ```markdown
               ## ğŸ¤– Claude Code ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ
               
               ### âœ… è‰¯ã„ç‚¹
               - 
               
               ### âš ï¸ æ”¹å–„ææ¡ˆ
               - 
               
               ### ğŸ› æ½œåœ¨çš„ãªå•é¡Œ
               - 
               
               ### ğŸ“Š ãƒ¡ãƒˆãƒªã‚¯ã‚¹
               - ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸: X%
               - Lint è­¦å‘Š: X ä»¶
               - ãƒ“ãƒ«ãƒ‰æ™‚é–“ã¸ã®å½±éŸ¿: +Xs
               ```
            
            ## ã‚³ãƒ¼ãƒ‰å®Ÿè£…æ™‚ã®å“è³ªç¢ºä¿
            
            ã‚³ãƒ¼ãƒ‰å®Ÿè£…å¾Œã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †ç•ªã«å¿…ãšå®Ÿè¡Œã—ã¦ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ï¼š
            1. './gradlew lint' ã‚’å®Ÿè¡Œã—ã¦ Android lint ã®å•é¡Œã‚’ãƒã‚§ãƒƒã‚¯
            2. ç™ºè¦‹ã•ã‚ŒãŸ lint ã®è­¦å‘Šã‚„ã‚¨ãƒ©ãƒ¼ã‚’å ±å‘Š
            3. lint ã®å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ä¿®æ­£ã‚’è©¦ã¿ã‚‹
            4. './gradlew test' ã‚’å®Ÿè¡Œã—ã¦ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ç¢ºèª
            5. './gradlew assembleDebug' ã‚’å®Ÿè¡Œã—ã¦ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª
            6. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’å ±å‘Šã—ã¦ä¿®æ­£ã‚’è©¦ã¿ã‚‹
            
            é‡è¦ï¼šã‚³ãƒ¼ãƒ‰å®Ÿè£…ã‚¿ã‚¹ã‚¯ã®æœ€çµ‚ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€å¿…ãš lint ãƒã‚§ãƒƒã‚¯ã€ãƒ†ã‚¹ãƒˆã€ãƒ“ãƒ«ãƒ‰ç¢ºèªã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
            
            ## ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆãƒ«ãƒ¼ãƒ«
            
            git commit ã‚’ä½œæˆã™ã‚‹éš›ã¯ã€å¿…ãšã“ã®ãƒªãƒã‚¸ãƒˆãƒªã® .commit_template ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã€ãã“ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨çµµæ–‡å­—ã®ãƒ«ãƒ¼ãƒ«ã«å®Œå…¨ã«å¾“ã£ã¦ãã ã•ã„ã€‚
            
            å…·ä½“çš„ã«ã¯ï¼š
            1. .commit_template ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§å†…å®¹ã‚’ç¢ºèªã™ã‚‹
            2. é©åˆ‡ãªçµµæ–‡å­—ã‚’é¸æŠï¼ˆ:sparkles:, :+1:, :bug: ãªã©ï¼‰
            3. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ `:emoji: Subject` ã«å¾“ã†
            4. Subject ã¯50æ–‡å­—ä»¥å†…ã€å‘½ä»¤å½¢ã§è¨˜è¿°
            5. Body ãŒã‚ã‚‹å ´åˆã¯ã€Subject ã¨1è¡Œç©ºã‘ã¦ã€72æ–‡å­—ä»¥å†…ã§ What/Why ã‚’è¨˜è¼‰
            
            ## Android é–‹ç™ºå›ºæœ‰ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
            
            1. **Compose ç§»è¡Œã‚µãƒãƒ¼ãƒˆ**
               - Fragment ã‹ã‚‰ Compose ã¸ã®æ®µéšçš„ç§»è¡Œã‚’æ”¯æ´
               - Compose ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’é©ç”¨
               - State hoisting ã¨ãƒªã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³æœ€é©åŒ–
            
            2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
               - ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¢ãƒ—ãƒªã¨ã—ã¦ã®èµ·å‹•é€Ÿåº¦ã‚’é‡è¦–
               - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€å°åŒ–
               - ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»ã®è€ƒæ…®
            
            3. **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**
               - JUnit ã§ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
               - Compose UI ãƒ†ã‚¹ãƒˆ
               - Espresso ã§ã®çµ±åˆãƒ†ã‚¹ãƒˆ
